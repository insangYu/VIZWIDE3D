class Clipping{constructor(a,b){let c=this,d=new Map();function e(h){let i=a['Data']['ClipItem']();d['set'](i['id'],i);let j=a['Data']['GetBBox']();i['itemType']=h;switch(i['itemType']){case b['Enum']['CLIPPING_MODES']['X']:{let k=a['Data']['ClipPlane']();k['normal']=new b['Vector3'](-0x1,0x0,0x0),k['center']['copy'](j['center']),i['planes']['push'](k);let l=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);l['enable']=![],l['center']['copy'](k['center']),l['axis']['x']['enable']=!![],l['axis']['x']['normal']['copy'](k['normal']),l['axis']['x']['normal']['multiplyScalar'](-0x1),l['object']=k,k['handle']=l;}break;case b['Enum']['CLIPPING_MODES']['Y']:{let m=a['Data']['ClipPlane']();m['normal']=new b['Vector3'](0x0,-0x1,0x0),m['center']['copy'](j['center']),i['planes']['push'](m);let n=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);n['enable']=![],n['center']['copy'](m['center']),n['axis']['y']['enable']=!![],n['axis']['y']['normal']['copy'](m['normal']),n['axis']['y']['normal']['multiplyScalar'](-0x1),n['object']=m,m['handle']=n;}break;case b['Enum']['CLIPPING_MODES']['Z']:{let o=a['Data']['ClipPlane']();o['normal']=new b['Vector3'](0x0,0x0,-0x1),o['center']['copy'](j['center']),i['planes']['push'](o);let p=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);p['enable']=![],p['center']['copy'](o['center']),p['axis']['z']['enable']=!![],p['axis']['z']['normal']['copy'](o['normal']),p['axis']['z']['normal']['multiplyScalar'](-0x1),p['object']=o,o['handle']=p;}break;case b['Enum']['CLIPPING_MODES']['BOX']:{for(let q=0x0;q<0x6;q++){let r=a['Data']['ClipPlane']();i['planes'][q]=r;}{i['planes'][0x0]['normal']=new b['Vector3'](0x1,0x0,0x0),i['planes'][0x0]['center']=new b['Vector3'](j['min']['x'],j['center']['y'],j['center']['z']);let s=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);s['enable']=![],s['center']['copy'](i['planes'][0x0]['center']),s['axis']['x']['enable']=!![],s['axis']['x']['normal']['copy'](i['planes'][0x0]['normal']),s['axis']['x']['normal']['multiplyScalar'](-0x1),s['object']=i['planes'][0x0],i['planes'][0x0]['handle']=s;}{i['planes'][0x1]['normal']=new b['Vector3'](-0x1,0x0,0x0),i['planes'][0x1]['center']=new b['Vector3'](j['max']['x'],j['center']['y'],j['center']['z']);let t=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);t['enable']=![],t['center']['copy'](i['planes'][0x1]['center']),t['axis']['x']['enable']=!![],t['axis']['x']['normal']['copy'](i['planes'][0x1]['normal']),t['axis']['x']['normal']['multiplyScalar'](-0x1),t['object']=i['planes'][0x1],i['planes'][0x1]['handle']=t;}{i['planes'][0x2]['normal']=new b['Vector3'](0x0,0x1,0x0),i['planes'][0x2]['center']=new b['Vector3'](j['center']['x'],j['min']['y'],j['center']['z']);let u=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);u['enable']=![],u['center']['copy'](i['planes'][0x2]['center']),u['axis']['y']['enable']=!![],u['axis']['y']['normal']['copy'](i['planes'][0x2]['normal']),u['axis']['y']['normal']['multiplyScalar'](-0x1),u['object']=i['planes'][0x2],i['planes'][0x2]['handle']=u;}{i['planes'][0x3]['normal']=new b['Vector3'](0x0,-0x1,0x0),i['planes'][0x3]['center']=new b['Vector3'](j['center']['x'],j['max']['y'],j['center']['z']);let v=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);v['enable']=![],v['center']['copy'](i['planes'][0x3]['center']),v['axis']['y']['enable']=!![],v['axis']['y']['normal']['copy'](i['planes'][0x3]['normal']),v['axis']['y']['normal']['multiplyScalar'](-0x1),v['object']=i['planes'][0x3],i['planes'][0x3]['handle']=v;}{i['planes'][0x4]['normal']=new b['Vector3'](0x0,0x0,0x1),i['planes'][0x4]['center']=new b['Vector3'](j['center']['x'],j['center']['y'],j['min']['z']);let w=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);w['enable']=![],w['center']['copy'](i['planes'][0x4]['center']),w['axis']['z']['enable']=!![],w['axis']['z']['normal']['copy'](i['planes'][0x4]['normal']),w['axis']['z']['normal']['multiplyScalar'](-0x1),w['object']=i['planes'][0x4],i['planes'][0x4]['handle']=w;}{i['planes'][0x5]['normal']=new b['Vector3'](0x0,0x0,-0x1),i['planes'][0x5]['center']=new b['Vector3'](j['center']['x'],j['center']['y'],j['max']['z']);let x=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['CLIPPING']);x['enable']=![],x['center']['copy'](i['planes'][0x5]['center']),x['axis']['z']['enable']=!![],x['axis']['z']['normal']['copy'](i['planes'][0x5]['normal']),x['axis']['z']['normal']['multiplyScalar'](-0x1),x['object']=i['planes'][0x5],i['planes'][0x5]['handle']=x;}}break;}return i;}function f(h){let i=d['get'](h);if(i===undefined)return;for(let j=0x0;j<i['planes']['length'];j++){if(i['planes'][j]['handle']===undefined)continue;a['Handle']['Delete'](i['planes'][j]['handle']['id']);}d['delete'](h);}function g(){let h=a['Clipping']['Get']();if(h===undefined)return;let i=undefined,j,k,l,m=0x1;switch(h['itemType']){case b['Enum']['CLIPPING_MODES']['X']:case b['Enum']['CLIPPING_MODES']['Y']:case b['Enum']['CLIPPING_MODES']['Z']:{let n=a['Data']['GetBBox']();i=a['Util']['GetBBox2Vertex'](n),m=0x1;}break;case b['Enum']['CLIPPING_MODES']['BOX']:{let o,p;for(let r=0x0;r<h['planes']['length'];r++){r===0x0?(o=new b['Vector3']()['copy'](h['planes'][r]['center']),p=new b['Vector3']()['copy'](h['planes'][r]['center'])):(o['min'](h['planes'][r]['center']),p['max'](h['planes'][r]['center']));}let q=a['Data']['BBox']([o['x'],o['y'],o['z'],p['x'],p['y'],p['z']]);h['planes'][0x0]['center']=new b['Vector3'](q['min']['x'],q['center']['y'],q['center']['z']),h['planes'][0x1]['center']=new b['Vector3'](q['max']['x'],q['center']['y'],q['center']['z']),h['planes'][0x2]['center']=new b['Vector3'](q['center']['x'],q['min']['y'],q['center']['z']),h['planes'][0x3]['center']=new b['Vector3'](q['center']['x'],q['max']['y'],q['center']['z']),h['planes'][0x4]['center']=new b['Vector3'](q['center']['x'],q['center']['y'],q['min']['z']),h['planes'][0x5]['center']=new b['Vector3'](q['center']['x'],q['center']['y'],q['max']['z']),h['planes'][0x0]['handle']['center']=new b['Vector3'](q['min']['x'],q['center']['y'],q['center']['z']),h['planes'][0x1]['handle']['center']=new b['Vector3'](q['max']['x'],q['center']['y'],q['center']['z']),h['planes'][0x2]['handle']['center']=new b['Vector3'](q['center']['x'],q['min']['y'],q['center']['z']),h['planes'][0x3]['handle']['center']=new b['Vector3'](q['center']['x'],q['max']['y'],q['center']['z']),h['planes'][0x4]['handle']['center']=new b['Vector3'](q['center']['x'],q['center']['y'],q['min']['z']),h['planes'][0x5]['handle']['center']=new b['Vector3'](q['center']['x'],q['center']['y'],q['max']['z']),i=a['Util']['GetBBox2Vertex'](q),m=0x0;}break;}if(i===undefined)return;for(let s=0x0;s<h['planes']['length'];s++){l=new b['Vector3']()['copy'](h['planes'][s]['normal']),j=new b['Vector3'](0x1,0x0,0x0);if(Math['abs'](j['dot'](l))>0.99)j['set'](0x0,0x0,0x1);k=new b['Vector3']()['crossVectors'](l,j)['normalize'](),j=new b['Vector3']()['crossVectors'](k,l)['normalize']();let t,u,v,w;for(let G=0x0;G<0x8;G++){let H=new b['Vector3']()['subVectors'](i[G],h['planes'][s]['center']),I=H['dot'](j),J=H['dot'](k);G===0x0?(t=I,u=I,v=J,w=J):(t=Math['min'](I,t),u=Math['max'](I,u),v=Math['min'](J,v),w=Math['max'](J,w));}let x=Math['max'](t*0.05,-0xa),y=Math['min'](u*0.05,0xa),z=Math['max'](v*0.05,-0xa),A=Math['min'](w*0.05,0xa),B=new b['Vector3']()['copy'](j)['multiplyScalar'](t+x*m),C=new b['Vector3']()['copy'](j)['multiplyScalar'](u+y*m),D=new b['Vector3']()['copy'](k)['multiplyScalar'](v+z*m),E=new b['Vector3']()['copy'](k)['multiplyScalar'](w+A*m),F;F=new b['Vector3']()['addVectors'](new b['Vector3']()['addVectors'](h['planes'][s]['center'],B),D),h['planes'][s]['vertex'][0x0]=F,F=new b['Vector3']()['addVectors'](new b['Vector3']()['addVectors'](h['planes'][s]['center'],C),D),h['planes'][s]['vertex'][0x1]=F,F=new b['Vector3']()['addVectors'](new b['Vector3']()['addVectors'](h['planes'][s]['center'],B),E),h['planes'][s]['vertex'][0x2]=F,F=new b['Vector3']()['addVectors'](new b['Vector3']()['addVectors'](h['planes'][s]['center'],C),E),h['planes'][s]['vertex'][0x3]=F;}}this['IsClipping']=function(){let h=a['Clipping']['Get']();return h!==undefined?!![]:![];},this['CreateClipping']=function(h){d['forEach'](function(j){f(j['id']);});let i=e(h);return g(),a['Shader']['UpdateShader'](),a['Renderer']['MainFBClear'](),a['MeshBlock']['Reset'](),a['Renderer']['Render'](),i;},this['GetClipping']=function(h){let i=undefined;return d['forEach'](function(j){if(j['id']===h)return i=j,!![];return![];}),i;},this['Get']=function(){let h=undefined;return d['forEach'](function(i){if(i['enable'])return h=i,!![];return![];}),h;},this['Update']=function(){g();},this['Inverse']=function(){let h=a['Clipping']['Get']();if(h===undefined)return;if(h['itemType']===b['Enum']['CLIPPING_MODES']['BOX'])return;for(let i=0x0;i<h['planes']['length'];i++){h['planes'][i]['normal']['multiplyScalar'](-0x1),h['planes'][i]['handle']!==undefined&&(h['planes'][i]['handle']['axis']['x']['normal']['multiplyScalar'](-0x1),h['planes'][i]['handle']['axis']['y']['normal']['multiplyScalar'](-0x1),h['planes'][i]['handle']['axis']['z']['normal']['multiplyScalar'](-0x1));}a['Renderer']['MainFBClear'](),a['MeshBlock']['Reset'](),a['Renderer']['Render']();},this['Clear']=function(){if(d['size']<=0x0)return;d['forEach'](function(h,i,j){f(h['id']);}),a['Shader']['UpdateShader'](),a['Renderer']['MainFBClear'](),a['MeshBlock']['Reset'](),a['Renderer']['Render']();},this['IsClippingPosition']=function(h){let i=a['Clipping']['Get']();if(i===undefined)return![];for(let j=0x0;j<i['planes']['length'];j++){let k=new b['Plane']()['setFromNormalAndCoplanarPoint'](i['planes'][j]['normal'],i['planes'][j]['center']);const l=k['distanceToPoint'](h);if(l<0x0)return!![];}return![];},this['SetClippingBoxSize']=function(h,i){let j=d['get'](h);if(j===undefined)return;i['update'](),j['planes'][0x0]['center']=new b['Vector3'](i['min']['x'],i['center']['y'],i['center']['z']),j['planes'][0x1]['center']=new b['Vector3'](i['max']['x'],i['center']['y'],i['center']['z']),j['planes'][0x2]['center']=new b['Vector3'](i['center']['x'],i['min']['y'],i['center']['z']),j['planes'][0x3]['center']=new b['Vector3'](i['center']['x'],i['max']['y'],i['center']['z']),j['planes'][0x4]['center']=new b['Vector3'](i['center']['x'],i['center']['y'],i['min']['z']),j['planes'][0x5]['center']=new b['Vector3'](i['center']['x'],i['center']['y'],i['max']['z']),g();},this['RebuildClippingBoundBox']=function(h){let k=a['Clipping']['Get']();if(k===undefined)return h;let l=![],m=!![],n=new b['Vector3']()['copy'](h['min']),o=new b['Vector3']()['copy'](h['max']),p=a['Util']['GetBBox2Vertex'](h);for(let q=0x0;q<k['planes']['length'];q++){const r=new b['Plane']()['setFromNormalAndCoplanarPoint'](k['planes'][q]['normal'],k['planes'][q]['center']);let s=0x0;for(let t=0x0;t<0x8;t++){const u=r['distanceToPoint'](p[t]);u<0x0&&s++;}if(s===0x8)continue;l=!![];for(let v=0x0;v<0x8;v++){const w=r['distanceToPoint'](p[v]);if(w<0x0){const x=new b['Vector3']()['copy'](k['planes'][q]['normal'])['multiplyScalar'](w),y=new b['Vector3']()['subVectors'](p[v],x);m?(m=![],n['copy'](y),o['copy'](y)):(n['min'](y),o['max'](y));}else m?(m=![],n['copy'](p[v]),o['copy'](p[v])):(n['min'](p[v]),o['max'](p[v]));}}if(m)return undefined;return a['Data']['BBox']([n['x'],n['y'],n['z'],o['x'],o['y'],o['z']]);},this['PickPlane']=function(h,i){if(d['size']<=0x0)return;const j=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),k=new b['Matrix4']()['multiplyMatrices'](a['Camera']['projectionMatrix'],j);let l;l=new b['Vector3'](h,i,-0x1);let m=new b['Vector3'](l['x'],l['y'],l['z']),n=new b['Vector3'](l['x'],l['y'],0x1),o,p;o=a['Camera']['screen2WorldWithMatrix'](k,m),p=a['Camera']['screen2WorldWithMatrix'](k,n),d['forEach'](function(q,r,s){if(!q['enable'])return;let t=-0x1,u=![],v,w;for(let z=0x0;z<q['planes']['length'];z++){if(q['planes'][z]['vertex']['length']<=0x0)continue;if(q['planes'][z]['visible']===![])continue;let A=a['Util']['LineToTriangleIntersections'](o,p,q['planes'][z]['vertex'][0x0],q['planes'][z]['vertex'][0x1],q['planes'][z]['vertex'][0x2]);if(A[0x0]===0x1){let C=new b['Vector3']()['subVectors'](o,A[0x1])['length']();if(u===![])u=!![],t=z,w=A[0x1],v=C;else C<v&&(t=z,w=A[0x1],v=C);continue;}let B=a['Util']['LineToTriangleIntersections'](o,p,q['planes'][z]['vertex'][0x1],q['planes'][z]['vertex'][0x2],q['planes'][z]['vertex'][0x3]);if(B[0x0]===0x1){let D=new b['Vector3']()['subVectors'](o,B[0x1])['length']();if(u===![])u=!![],t=z,w=B[0x1],v=D;else D<v&&(t=z,w=B[0x1],v=D);continue;}}if(u===!![]&&q['planes'][t]['handle']!==undefined){if(q['planes'][t]['handle']['enable'])return;for(let F=0x0;F<q['planes']['length'];F++){if(q['planes'][t]['handle']['state']!==b['Enum']['HANDLE_MOUSE_STATE']['DOWN'])q['planes'][F]['handle']['enable']=![];}q['planes'][t]['handle']['enable']=!![],a['Renderer']['Render']();let E=function(){if(q['planes'][t]['handle']===undefined)return;q['planes'][t]['handle']['state']===b['Enum']['HANDLE_MOUSE_STATE']['DOWN']?setTimeout(E,0xbb8):(q['planes'][t]['handle']['enable']=![],a['Renderer']['Render']());};setTimeout(E,0xbb8);}});};}}export default Clipping;