let UIFly=function(a,b){let c=this;this['base']=b['UIBase'],this['base'](a,b);let d=![],e=![],f=![],g=![],h=![],i=![],j=![],k=![],l=![],m=![],n=![],o=![];this['movementSpeed']=0x4e20,this['aroundSpeed']=0.18,this['aroundWheelFactor']=0xa,this['timeLastUpdate']=undefined,this['aroundTimer']=undefined,this['EventCnt']=0x0;let p=!![],q=![],r=new Map(),s=0x0;t();function t(){}function u(v,w){c['movementSpeed']=c['view']['Configuration']['Control']['Fly']['MovementSpeed']*0x3e8,c['aroundSpeed']=c['view']['Util']['DegToRad'](c['view']['Configuration']['Control']['Fly']['AroundSpeed']),c['aroundWheelFactor']=0xa;let z=new b['Vector3'](),A=new b['Vector3'](),B=0x0,C=0x0;if(j){C=-0x1*c['aroundSpeed'];if(c['mouseWheelOn'])C*=c['aroundWheelFactor'];}if(k){C=0x1*c['aroundSpeed'];if(c['mouseWheelOn'])C*=c['aroundWheelFactor'];}let D=new Date()['getTime'](),E=D-c['timeLastUpdate'];E/=0x3e8,c['timeLastUpdate']=D;let F=c['movementSpeed'];F=a['Data']['GetUnitValue'](F);if(n){B=v-c['mouseDownPosition']['x'],C=w-c['mouseDownPosition']['y'],B=B*c['aroundSpeed']*E,C=C*c['aroundSpeed']*E;if(B<0x0)l=!![];if(B>0x0)m=!![];{C<0x0&&(j=!![],k=![]),C>0x0&&(j=![],k=!![]),d=!![],e=![];}}let G=new b['Vector3'](0x1,0x0,0x0),H=new b['Vector3'](0x0,0x1,0x0),I=new b['Vector3'](0x0,0x0,0x1);d&&!e&&z['add'](new b['Vector3']()['copy'](I)['multiplyScalar'](c['movementSpeed'])['multiplyScalar'](E));!d&&e&&z['sub'](new b['Vector3']()['copy'](I)['multiplyScalar'](F)['multiplyScalar'](E));f&&!g&&z['add'](new b['Vector3']()['copy'](G)['multiplyScalar'](F)['multiplyScalar'](E));!f&&g&&z['sub'](new b['Vector3']()['copy'](G)['multiplyScalar'](F)['multiplyScalar'](E));h&&!i&&A['sub'](new b['Vector3']()['copy'](H)['multiplyScalar'](F)['multiplyScalar'](E));!h&&i&&A['add'](new b['Vector3']()['copy'](H)['multiplyScalar'](F)['multiplyScalar'](E));if(j&&!k){}if(!j&&k){}if(!d&&!e&&!f&&!g&&!h&&!i&&!j&&!k&&!l&&!m){}else{(d||e||f||g||h||i)&&(a['Camera']['cameraMatrix']['translate'](z['x'],z['y'],z['z']),a['Camera']['cameraMatrix']['translate'](A['x'],A['y'],A['z']));if(j||k||l||m){l=![],m=![],d=![],e=![],j=![],k=![];let J=new b['Matrix4'](),K=new b['Matrix4']();if(a['Configuration']['Control']['RotateScreenRate']){let L=a['Renderer']['GetSizeWidth'](),M=a['Renderer']['GetSizeHeight'](),N=0xa,O=0xa;B=B/L*N,C=C/M*O;}else{let P=0x64;B=B/P,C=C/P;}{let Q=new b['Matrix4']()['makeRotationX'](C),R=new b['Matrix4']()['makeRotationY'](B),S=new b['Matrix4']()['makeRotationZ'](B);{let X=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),Y=new b['Vector3'](0x0,0x0,0x1),Z=new b['Vector3'](0x0,0x0,0x0);Y['applyMatrix4'](X),Z['applyMatrix4'](X);if(Y['y']<Z['y'])S=new b['Matrix4']()['makeRotationZ'](-B/0x64);}let T=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),U=new b['Matrix4']()['getInverse'](T),V=U['multiplyVector'](a['Camera']['cameraPosition']);{let a0=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),a1=new b['Vector3']()['copy'](V);a1['applyMatrix4'](a0);let a2=new b['Matrix4'](),a3=new b['Vector3']()['copy'](a1)['multiplyScalar'](-0x1);a2['setPosition'](a3);let a4=new b['Matrix4']()['copy'](Q),a5=new b['Matrix4']()['setPosition'](a1),a6=new b['Matrix4']()['multiplyMatrices'](a4,a2);J=new b['Matrix4']()['multiplyMatrices'](a5,a6);}{let a7=new b['Vector3']()['copy'](V),a8=new b['Matrix4'](),a9=new b['Vector3']()['copy'](a7)['multiplyScalar'](-0x1);a8['setPosition'](a9);let aa=new b['Matrix4']()['copy'](S),ab=new b['Matrix4']()['setPosition'](a7),ac=new b['Matrix4']()['multiplyMatrices'](aa,a8);K=new b['Matrix4']()['multiplyMatrices'](ab,ac);}let W=new b['Matrix4']()['multiplyMatrices'](a['Camera']['cameraMatrix'],K);a['Camera']['cameraMatrix']=new b['Matrix4']()['multiplyMatrices'](J,W);}}a['Camera']['ResizeGLWindow'](),s%0x32===0x0&&(a['MeshBlock']['Reset'](),s=0x0),a['Renderer']['MainFBClear'](![]),a['Renderer']['Render'](),s++;}if(!j&&!k&&!l&&!m){}else{if(0x0){let ad=new b['Matrix4']()['makeRotationX'](C/0x64),ae=new b['Matrix4']()['makeRotationY'](B/0x64);{let af=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),ag=new b['Matrix4']()['getInverse'](af),ah=new b['Vector3']()['copy'](a['Camera']['pivot']),ai=ag['multiplyVector'](a['Camera']['cameraPosition']),aj=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),ak=new b['Vector3']()['copy'](ai);ak['applyMatrix4'](aj);let al=new b['Matrix4'](),am=new b['Vector3']()['copy'](ak)['multiplyScalar'](-0x1);al['setPosition'](am);let an;an=new b['Matrix4']()['multiplyMatrices'](ad,ae);let ao=new b['Matrix4']()['setPosition'](ak),ap=new b['Matrix4']()['multiplyMatrices'](an,al),aq=new b['Matrix4']()['multiplyMatrices'](ao,ap);}}}}this['UIBegin']=function(){c['base']['prototype']['UIBegin']['call'](c),p=![],q=![],c['timeLastUpdate']=new Date()['getTime'](),c['aroundTimer']=setInterval(function(){if(n)p=!![];if(q!==p)c['timeLastUpdate']=new Date()['getTime']();if(p)u(c['mouse']['x'],c['mouse']['y']);q=p;},0xa);},this['UIEnd']=function(){c['aroundTimer']!==null&&(clearInterval(c['aroundTimer']),c['aroundTimer']=null),c['base']['prototype']['UIEnd']['call'](c);},this['mouseDown']=function(v,w,z){c['actionEnabled']=![];let A=c['base']['prototype']['mouseDown']['call'](c,v,w,z);c['actionEnabled']=!![],n=!![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=!![];return A;},this['mouseMove']=function(v,w){c['actionEnabled']=![],c['base']['prototype']['mouseMove']['call'](c,v,w),c['actionEnabled']=!![];},this['mouseUp']=function(v,w,z){let A=c['base']['prototype']['mouseUp']['call'](c,v,w,z);d=![],e=![],n=![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=![];return A;},this['mouseWheel']=function(v,w,z){c['EventCnt']++,c['mouseWheelOn']=!![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=!![];if(z<0x0)k=!![],j=![],p=!![];else z>0x0&&(k=![],j=!![],p=!![]);setTimeout(function(){c['EventCnt']--;if(c['EventCnt']===0x0){c['mouseWheelOn']=![],k=![],j=![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=![];}},0x1e);},this['mouseOver']=function(){c['base']['prototype']['mouseOver']['call'](c);},this['mouseOut']=function(v,w,z){n=![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=![];c['actionEnabled']=![];let A=c['base']['prototype']['mouseUp']['call'](c,v,w,z);c['actionEnabled']=!![],a['MeshBlock']['Reset'](),a['Renderer']['MainFBClear'](),a['Renderer']['Render']();},this['keyPress']=function(v){switch(v){case 0x26:case 0x77:case 0x57:{r['set'](0x0,!![]),d=!![];}break;case 0x25:case 0x61:case 0x41:{r['set'](0x1,!![]),f=!![];}break;case 0x28:case 0x73:case 0x53:{r['set'](0x2,!![]),e=!![];}break;case 0x27:case 0x64:case 0x44:{r['set'](0x3,!![]),g=!![];}break;case 0x72:case 0x52:{r['set'](0x4,!![]),h=!![];}break;case 0x66:case 0x46:{r['set'](0x5,!![]),i=!![];}break;}p=!![];if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=!![];},this['keyUp']=function(v){switch(v){case 0x26:case 0x77:case 0x57:{r['set'](0x0,![]),d=![];}break;case 0x25:case 0x61:case 0x41:{r['set'](0x1,![]),f=![];}break;case 0x28:case 0x73:case 0x53:{r['set'](0x2,![]),e=![];}break;case 0x27:case 0x64:case 0x44:{r['set'](0x3,![]),g=![];}break;case 0x72:case 0x52:{r['set'](0x4,![]),h=![];}break;case 0x66:case 0x46:{r['set'](0x5,![]),i=![];}break;}let w=![],x=function(y,z,A){if(y)w=!![];};r['forEach'](x),p=w;if(a['useRenderLimit'])a['Renderer']['enableRenderLimit']=![];a['Renderer']['MainFBClear'](),a['Renderer']['Render'](),a['MeshBlock']['Reset']();},this['mouseDoubleClick']=function(v,w,z){d=![],e=![],f=![],g=![],h=![],i=![];const A=a['Renderer']['Picking'](v,w);if(A===undefined)return;const B=a['Data']['GetPickByBody'](A['bodyId'],v,w);if(!B['pick'])return;let C=B['position'];if(C===undefined)return;let D=0x708;D=a['Data']['GetUnitValue'](D),a['Camera']['pivot']=C;for(let I=0x0;I<0x10;I++)a['Camera']['SetZAxis2Up']();let E=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),F=new b['Matrix4']()['multiplyMatrices'](a['Camera']['projectionMatrix'],E),G=new b['Vector3']()['copy'](C);G['z']+=D;let H=a['Camera']['cameraMatrix']['multiplyVector'](new b['Vector3']()['copy'](G));a['Camera']['cameraMatrix']['translate'](-H['x'],-H['y'],-H['z']+a['Camera']['viewDistance']),a['Camera']['pivot']=G,a['Camera']['ResizeGLWindow'](),a['MeshBlock']['Reset'](),a['Renderer']['MainFBClear'](),a['Renderer']['Render']();},this['MouseLog']=function(){console['log']('UIFly.mouse\x20:\x20'+c['mouse']['x']+','+c['mouse']['y']);},this['Render2D']=function(v){if(c['mouseLeftDown']){if(c['mouseDownPosition']['x']!==c['mouse']['x']&&c['mouseDownPosition']['y']!==c['mouse']['y']){let w=0x5,x=0x2,y=0x23;v['fillStyle']='rgba(255,255,255,0.6)',v['strokeStyle']='rgba(64,64,64,0.3)',v['lineWidth']=w,v['strokeRect'](c['mouseDownPosition']['x']-y,c['mouseDownPosition']['y']-w/0x2,y-w-x,w),v['fillRect'](c['mouseDownPosition']['x']-y,c['mouseDownPosition']['y']-w/0x2,y-w-x,w),v['strokeRect'](c['mouseDownPosition']['x']+w+x,c['mouseDownPosition']['y']-w/0x2,y-w,w),v['fillRect'](c['mouseDownPosition']['x']+w+x,c['mouseDownPosition']['y']-w/0x2,y-w,w),v['strokeRect'](c['mouseDownPosition']['x']-w/0x2,c['mouseDownPosition']['y']-y,w,y-w-x),v['fillRect'](c['mouseDownPosition']['x']-w/0x2,c['mouseDownPosition']['y']-y,w,y-w-x),v['strokeRect'](c['mouseDownPosition']['x']-w/0x2,c['mouseDownPosition']['y']+w+x,w,y-w),v['fillRect'](c['mouseDownPosition']['x']-w/0x2,c['mouseDownPosition']['y']+w+x,w,y-w);}}};};export default UIFly;