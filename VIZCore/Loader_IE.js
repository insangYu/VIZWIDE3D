class Loader{constructor(a){const b={'CTUnknown':0x0,'CTGeneralBinaryBlock':0x1,'CTStructure':0x2,'CTMeshBlock':0x3,'CTClashTestData':0x4,'CTImageData':0x5,'CTImageIdxTable':0x6,'CTMeshBlockTable':0x7,'CTEntityBinaryBlock':0x8,'CTBodyMeshData':0x9,'CTPropDic':0xa,'CTUserDefGroups':0xb,'CTFileMetaData':0xc,'CTAuthority':0xd,'CTNodePropTable':0xe,'CTNodePropTableIndices':0xf,'CTInitialInfo':0x10,'CTUserCustom':0x11,'CTEdgeTable':0x12,'CTThumbnail':0x13,'CTMisc':0x14,'CTStructureHeader':0x15,'CTMeshBlockSub':0x16,'CTStructureNameData':0x18,'CTSplitStructureMeshBlockFile':0x22,'CTSplitAreaMeshBlockList':0x23,'CTTreeInfo':0x26,'CTStructureFileInfoBlock':0x27,'CTMeshFileInfoBlock':0x28},c={'None':0x0,'Split':0xa,'Structure':0x14,'Structure_Tree':0x15,'Property':0x1e,'MeshBlock_New':0x28,'MeshBlock_Update':0x29,'MeshBlock_LOD':0x2a,'Header':0x64};let d=this,e=function(){let w={'typeStr':null,'version':null,'sizeTocItem':null,'nToc':null,'tocPos':null};return w;},f=function(){let w={'version':null,'datatype':null,'structure_cnt':null,'mesh_cnt':null,'property_cnt':null,'unit':null};return w;};this['parsetype']=0x0;function g(w){return decodeURIComponent(escape(w));}function h(w,x,y){const z=w['getUint32'](x,y),A=w['getUint32'](x+0x4,y),B=y?z+0x2*0x20*A:0x2*0x20*z+A;return B;}function i(w){let x='',y={'dom':/(http(s)?:\/\/|www.)([a-z0-9\w]+\.*)+[a-z0-9]{2,4}\//gi,'par':/(http(s)?:\/\/|www.)([a-z0-9\w]+\.*)+[a-z0-9]{2,4}([\/a-z0-9-%#?&=\w])+(\.[a-z0-9]{2,4}(\?[\/a-z0-9-%#?&=\w]+)*)*/gi};w['replace'](y['dom'],function(C){x=C;});let z=w['replace'](y['dom'],''),A=encodeURIComponent(z),B=x+A;return B;}function j(w,x,y,z){$['ajax']({'complete':function(){y(0x0,0x1);},'url':i(w['Url']),'type':'GET','beforeSend':function(){y(0x0,0x0,0x0,0x0);},'xhr':function(){let A=this,B=$['ajaxSettings']['xhr']();return B['responseType']='arraybuffer',B['onprogress']=function(C){let D=C['loaded']/C['total'];y(0x0,D,C['loaded'],C['total']);},B['addEventListener']('load',function(){let C=$()['jquery'],D=C['split']('.'),E=D[0x0]*0x1,F=D[0x1]*0x1;if(E<=0x2&&F<0x2)A['success'](B['response']);}),B;},'responseType':'arraybuffer','processData':![],'async':!![],'success':function(A){z(A,w),A=null;},'error':function(A,B,C){console['log'](A['status']),console['log'](C);}});}function k(w,x,y,z){y(0x0,0x0,0x0,0x0);let A=new XMLHttpRequest();A['open']('GET',w['Url'],!![]),A['responseType']='arraybuffer',A['onload']=function(B){A['status']===0xc8?z(A['response'],w):console['log'](A['statusText']);},A['send'](null);}function l(w,x,y){let z=[];for(let A=0x0;A<w;A++){let B=x['tocPos']+0xc+A*x['sizeTocItem'],C=y['getInt32'](B,!![]);B+=0x8;let D=h(y,B,!![]);B+=0x8;let E=y['getUint32'](B,!![]);B+=0x4;let F=y['getUint32'](B,!![]);B+=0x4;let G=0x0;d['parsetype']===0x1&&(G=y['getUint32'](B,!![]),B+=0x4);let H={'itemType':C,'position':D,'datasize':E,'uncompsize':F,'parsetype':G};z['push'](H);}return z;}function m(w,x){let y=-0x1;for(let z=x['length']-0x1;z>=0x0;z--){if(x[z]['itemType']===w){y=z;break;}}return y;}function n(w){if(w['DataType']===c['None']||w['DataType']===c['MeshBlock_New'])return!![];else return![];}function o(w,x){try{if(w===undefined)return undefined;let y=w['position'],z;return x===undefined?(z=new DataView(result,y,w['datasize']),z):(z=new DataView(x,y,w['datasize']),z);}catch(A){return undefined;}}function p(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0;for(let B=0x0;B<z;B++){let C=new VIZCore['Color']();C['r']=w['getUint8'](y,!![]),C['g']=w['getUint8'](y+0x1,!![]),C['b']=w['getUint8'](y+0x2,!![]),C['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let D=w['getUint32'](y,!![]);y+=0x4;let E=w['getUint32'](y,!![]);y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let P=w['getUint32'](y,!![]);y+=0x4;}let G=D/0xf,H=new Float32Array(w['buffer'],y+w['byteOffset'],D);y+=D*0x4;let I=new Float32Array(w['buffer'],y+w['byteOffset'],E);y+=E*0x4;let J=new Uint32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=w['getUint32'](y,!![]);y+=0x4;let L=[],M=[],N=0x0,O;for(let Q=0x0;Q<K;Q++){let R=w['getUint32'](y,!![]);y+=0x4;let S=w['getUint32'](y,!![]);y+=0x4,R=R+a['Data']['GetStartID'](x['ID']),S=S+a['Data']['GetStartID'](x['ID']);let T=w['getUint32'](y,!![]);y+=0x4;let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint16'](y,!![]);y+=0x2;let W=w['getUint16'](y,!![]);y+=0x2;let X=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let Y={'partId':R,'bodyId':S,'color':C,'m_vnIdx':T*0x3,'m_triIdx':U*0x3,'m_nVtx':V*0x3,'m_nTris':W*0x3,'BBox':a['Data']['BBox'](X),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};a['Data']['ObjectMap']['has'](x['Url'])?O=a['Data']['ObjectMap']['get'](x['Url'])[A]:O=a['Data']['Object3D']();{a['Data']['IDColor']['new'](),Y['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let Z=Y['m_nVtx']/0x3*0x4;for(let a0=0x0;a0<Z;a0=a0+0x4){M[N+a0+0x0]=a['Data']['IDColor']['r'],M[N+a0+0x1]=a['Data']['IDColor']['g'],M[N+a0+0x2]=a['Data']['IDColor']['b'],M[N+a0+0x3]=a['Data']['IDColor']['a'];}N+=Z,L['push'](Y);}}O['index']=A,O['attribs']['a_index']['array']=J,O['numElements']=O['attribs']['a_index']['array']['length'],O['attribs']['a_position']['array']=H,O['attribs']['a_normal']['array']=I;if(!a['Data']['ObjectMap']['has'](x['Url'])){for(let a1=0x0;a1<L['length'];a1++){L[a1]['object']=O,a['Data']['AddBody'](L[a1]);}O['attribs']['a_color']['array']=new Uint8Array(M,0x0,N),a['Data']['Objects']['push'](O),O['tag']=L,O['flag']['lod']=x['DataType'],O['link']=x['Url'];}if(x['DataType']===c['MeshBlock_LOD']){let a2=a['Data']['LODMap']['get'](x['Url']);a2===undefined?(a2=[],a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2)):(a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2));if(a['DataSplit']!==0x0){let a3=a['Data']['ObjectMap']['get'](x['Url']);a3===undefined?(a3=[],a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3)):(a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3));}}else{if(a['DataSplit']!==0x0){let a4=a['Data']['ObjectMap']['get'](x['Url']);a4===undefined?(a4=[],a4['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a4)):(a4['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a4));}}A++;}}function q(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0,B=!![];a['Data']['ObjectMap']['has'](x['Url'])&&(B=![]);for(let C=0x0;C<z;C++){let D=new VIZCore['Color']();D['r']=w['getUint8'](y,!![]),D['g']=w['getUint8'](y+0x1,!![]),D['b']=w['getUint8'](y+0x2,!![]),D['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let E=w['getUint32'](y,!![]);y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;let G=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let Q=w['getUint32'](y,!![]);y+=0x4;}let H=E/0xf,I=new Float32Array(w['buffer'],y+w['byteOffset'],E);y+=E*0x4;let J=new Float32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=new Uint32Array(w['buffer'],y+w['byteOffset'],G);y+=G*0x4;let L=w['getUint32'](y,!![]);y+=0x4;let M=[],N=[],O=0x0,P;!B?(P=a['Data']['ObjectMap']['get'](x['Url'])[A],P['flag']['updateProcess']=!![]):P=a['Data']['Object3D']();if(B){for(let R=0x0;R<L;R++){let S=w['getUint32'](y,!![]);y+=0x4;let T=w['getUint32'](y,!![]);y+=0x4,S=S+a['Data']['GetStartID'](x['ID']),T=T+a['Data']['GetStartID'](x['ID']);let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint32'](y,!![]);y+=0x4;let W=w['getUint16'](y,!![]);y+=0x2;let X=w['getUint16'](y,!![]);y+=0x2;let Y=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let Z={'partId':S,'bodyId':T,'color':D,'m_vnIdx':U*0x3,'m_triIdx':V*0x3,'m_nVtx':W*0x3,'m_nTris':X*0x3,'BBox':a['Data']['BBox'](Y),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};if(a['useTree']){let a0=a['Tree']['GetNode'](Z['bodyId']);a0!==undefined&&(Z['action']['visible']=a0['visible'],Z['action']['selection']=a0['selection']);}{a['Data']['IDColor']['new'](),Z['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let a1=Z['m_nVtx']/0x3*0x4;for(let a2=0x0;a2<a1;a2=a2+0x4){N[O+a2+0x0]=a['Data']['IDColor']['r'],N[O+a2+0x1]=a['Data']['IDColor']['g'],N[O+a2+0x2]=a['Data']['IDColor']['b'],N[O+a2+0x3]=a['Data']['IDColor']['a'];}O+=a1,M['push'](Z);}}{for(let a3=0x0;a3<M['length'];a3++){M[a3]['object']=P,a['Data']['AddBody'](M[a3]);}P['attribs']['a_color']['array']=new Uint8Array(N,0x0,O),a['Data']['Objects']['push'](P),P['tag']=M,P['flag']['lod']=x['DataType'],P['link']=x['Url'];}}else{for(let a4=0x0;a4<L;a4++){y+=0x4,y+=0x4,y+=0x4,y+=0x4,y+=0x2,y+=0x2,y+=0x18;let a5=P['tag'][a4];{let a6,a7,a8,a9;a6=a5['colorIdx']%0x100,a7=Math['floor'](a5['colorIdx']/0x100)%0x100,a8=Math['floor'](Math['floor'](a5['colorIdx']/0x100)/0x100)%0x100,a9=Math['floor'](Math['floor'](Math['floor'](a5['colorIdx']/0x100)/0x100)/0x100)%0x100;let aa=a5['m_nVtx']/0x3*0x4;for(let ab=0x0;ab<aa;ab=ab+0x4){N[O+ab+0x0]=a6,N[O+ab+0x1]=a7,N[O+ab+0x2]=a8,N[O+ab+0x3]=a9;}O+=aa;}}P['attribs']['a_color']['array']=new Uint8Array(N,0x0,O);}P['index']=A,P['link']=x['Url'],P['attribs']['a_index']['array']=K,P['numElements']=P['attribs']['a_index']['array']['length'],P['attribs']['a_position']['array']=I,P['attribs']['a_normal']['array']=J;if(B){let ac=a['Data']['ObjectMap']['get'](x['Url']);ac===undefined?(ac=[],ac['push'](P),a['Data']['ObjectMap']['set'](x['Url'],ac)):(ac['push'](P),a['Data']['ObjectMap']['set'](x['Url'],ac));}A++;}}function r(w,x){let y=0x0,z;z=w['getInt32'](y,!![]),y+=0x4;let A=0x0;for(let B=0x0;B<z;B++){let C=new VIZCore['Color']();C['r']=w['getUint8'](y,!![]),C['g']=w['getUint8'](y+0x1,!![]),C['b']=w['getUint8'](y+0x2,!![]),C['a']=w['getUint8'](y+0x3,!![]),y+=0x4;let D=w['getUint32'](y,!![]);y+=0x4;let E=w['getUint32'](y,!![]);y+=0x4;let F=w['getUint32'](y,!![]);y+=0x4;if(d['parsetype']===0x1){let P=w['getUint32'](y,!![]);y+=0x4;}let G=D/0xf,H=new Float32Array(w['buffer'],y+w['byteOffset'],D);y+=D*0x4;let I=new Float32Array(w['buffer'],y+w['byteOffset'],E);y+=E*0x4;let J=new Uint32Array(w['buffer'],y+w['byteOffset'],F);y+=F*0x4;let K=w['getUint32'](y,!![]);y+=0x4;let L=[],M=[],N=0x0,O;for(let Q=0x0;Q<K;Q++){let R=w['getUint32'](y,!![]);y+=0x4;let S=w['getUint32'](y,!![]);y+=0x4,R=R+a['Data']['GetStartID'](x['ID']),S=S+a['Data']['GetStartID'](x['ID']);let T=w['getUint32'](y,!![]);y+=0x4;let U=w['getUint32'](y,!![]);y+=0x4;let V=w['getUint16'](y,!![]);y+=0x2;let W=w['getUint16'](y,!![]);y+=0x2;let X=new Float32Array(w['buffer'],y+w['byteOffset'],0x6);y+=0x18;let Y={'partId':R,'bodyId':S,'color':C,'m_vnIdx':T*0x3,'m_triIdx':U*0x3,'m_nVtx':V*0x3,'m_nTris':W*0x3,'BBox':a['Data']['BBox'](X),'action':{'visible':!![],'selection':![],'transform':new VIZCore['Matrix4']()},'colorIdx':null,'object':null};O=a['Data']['Object3D']();{a['Data']['IDColor']['new'](),Y['colorIdx']=a['Data']['IDColor']['r']+(a['Data']['IDColor']['g']<<0x8)+(a['Data']['IDColor']['b']<<0x10)+a['Data']['IDColor']['a']*0x1000000;let Z=Y['m_nVtx']/0x3*0x4;for(let a0=0x0;a0<Z;a0=a0+0x4){M[N+a0+0x0]=a['Data']['IDColor']['r'],M[N+a0+0x1]=a['Data']['IDColor']['g'],M[N+a0+0x2]=a['Data']['IDColor']['b'],M[N+a0+0x3]=a['Data']['IDColor']['a'];}N+=Z,L['push'](Y);}}O['index']=A,O['attribs']['a_index']['array']=J,O['numElements']=O['attribs']['a_index']['array']['length'],O['attribs']['a_position']['array']=H,O['attribs']['a_normal']['array']=I;{for(let a1=0x0;a1<L['length'];a1++){L[a1]['object']=O,a['Data']['AddBody'](L[a1]);}O['attribs']['a_color']['array']=new Uint8Array(M,0x0,N),a['Data']['Objects']['push'](O),O['tag']=L,O['flag']['lod']=x['DataType'],O['link']=x['Url'];}if(x['DataType']===c['MeshBlock_LOD']){let a2=a['Data']['LODMap']['get'](x['Url']);a2===undefined?(a2=[],a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2)):(a2['push'](O),a['Data']['LODMap']['set'](x['Url'],a2));}else{if(a['DataSplit']!==0x0){let a3=a['Data']['ObjectMap']['get'](x['Url']);a3===undefined?(a3=[],a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3)):(a3['push'](O),a['Data']['ObjectMap']['set'](x['Url'],a3));}}A++;}}function s(w,x,y,z,A){if(w['Status']===0x3){z(a['Data']['ObjectMap']['get'](w['Url']),w);return;}let B=m(b['CTMeshBlock'],x),C=x[B],D=o(C,y);C!==undefined?setTimeout(function(){let E=0x0,F=D['getInt32'](E,!![]);E+=0x4;let G=0x0,H=function(){for(let I=G;I<F;I++){if(w['Crash']||w['Status']===0x3)break;let J=G/F;if(J===Infinity)J=0x0;let K=0x0;K=D['getInt32'](E,!![]),E+=0x4,toc=x[K];let L=o(toc,y);if(w['DataType']===c['MeshBlock_LOD'])q(L,w);else r(L,w);G++;if(G!==F){setTimeout(function(){H();},0x1);break;}else setTimeout(function(){z(a['Data']['ObjectMap']['get'](w['Url']),w);},0x1);}if(w['Crash']||w['Status']===0x3)z(a['Data']['ObjectMap']['get'](w['Url']),w);};setTimeout(function(){if(!a['useFramebuffer'])A(0x1,0x0);H();},0x1);},0x1):z(a['Data']['ObjectMap']['get'](w['Url']),w);}function t(w,x,y,z){let A=m(b['CTTreeInfo'],x),B=x[A],C=o(B,y),D=m(b['CTStructure'],x),E=x[D],F=o(E,y),G=m(b['CTStructureNameData'],x),H=x[G],I=o(H,y);if(z!==undefined)z(w,C,F,I);}function u(w,x,y,z){let A=m(b['CTSplitStructureMeshBlockFile'],x),B=x[A],C=o(B,y),D=0x0,E=new Int32Array(C['buffer'],D+C['byteOffset'],0x6),F=f();F['version']=E[0x0],F['datatype']=E[0x1],F['structure_cnt']=E[0x2],F['mesh_cnt']=E[0x3],F['property_cnt']=E[0x4],F['unit']=E[0x5],a['Data']['Accumulation']=F['unit'],D=0x0;let G=[],H=m(b['CTStructureFileInfoBlock'],x),I=x[H],J=o(I,y);for(let O=0x0;O<F['structure_cnt'];O++){let P=J['getInt32'](D,!![]);D+=0x4;let Q=new Uint8Array(J['buffer'],J['byteOffset']+D,P),R=String['fromCharCode']['apply'](null,Q);try{R=g(R);}catch(T){}let S=a['Data']['GetPath'](w['Url']);G['push'](S+R);}D=0x0;let K=[],L=m(b['CTMeshFileInfoBlock'],x),M=x[L],N=o(M,y);for(let U=0x0;U<F['mesh_cnt'];U++){let V=N['getInt32'](D,!![]);D+=0x4;let W=new Uint8Array(N['buffer'],N['byteOffset']+D,V);D+=V;let X=String['fromCharCode']['apply'](null,W);try{X=g(X);}catch(ai){}let Y=N['getInt32'](D,!![]);D+=0x4;let Z=N['getInt32'](D,!![]);D+=0x4;let a0=N['getInt32'](D,!![]);D+=0x4;let a1=N['getInt32'](D,!![]);D+=0x4;let a2=N['getFloat32'](D,!![]);D+=0x4;let a3=N['getFloat32'](D,!![]);D+=0x4;let a4=N['getFloat32'](D,!![]);D+=0x4;let a5=N['getFloat32'](D,!![]);D+=0x4;let a6=N['getFloat32'](D,!![]);D+=0x4;let a7=N['getFloat32'](D,!![]);D+=0x4;let a8=N['getFloat32'](D,!![]);D+=0x4;let a9=N['getFloat32'](D,!![]);D+=0x4;let aa=N['getInt32'](D,!![]);D+=0x4,W=new Uint8Array(N['buffer'],N['byteOffset']+D,aa),D+=aa;let ab=String['fromCharCode']['apply'](null,W);try{ab=g(ab);}catch(aj){}let ac=[],ad=[];ad[0x0]=a4,ad[0x1]=a5,ad[0x2]=a6,ad[0x3]=a7,ad[0x4]=a8,ad[0x5]=a9;let ae=a['Data']['GetPath'](w['Url']),af=ae+X,ag=[];ag['push'](af);let ah={'bbox':a['Data']['BBox'](ad),'list':ag,'lod':Y,'lod_sequence':U,'file':af,'tri_num':a1,'area':a2,'area_num':a3,'index_start':Z,'index_end':a0};ac['push'](ah),K['push'](ac);}z(w,G,K);}function v(w,x,y,z){let A=new DataView(w),B=0x0,C=e(),D=new Uint8Array(w,B,0x10);C['typeStr']=String['fromCharCode']['apply'](null,D),B+=0x10,C['version']=A['getInt32'](B,!![]),B+=0x4,C['sizeTocItem']=A['getInt32'](B,!![]),B+=0x4,C['nToc']=A['getInt32'](B,!![]),B+=0x4,C['tocPos']=h(A,B,!![]),B+=0x8;let E=0x0,F=0x0,G=C['tocPos'];E=A['getInt32'](G,!![]),G+=0x4,F=h(A,G,!![]),G+=0x8;let H=[];H=l(E,C,A),x['DataType']===c['Header']&&u(x,H,w,y),x['DataType']===c['Structure_Tree']&&t(x,H,w,y),x['DataType']===c['MeshBlock_LOD']&&s(x,H,w,y,z);}this['Load']=function(w,x,y){d['Download'](w,x,y);},this['Download']=function(w,x,y){let z=x,A=y;function B(C,D){v(C,D,z,A);}k(w,z,A,B);};}}export default Loader;