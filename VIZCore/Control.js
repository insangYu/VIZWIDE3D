import a from'./UI_Base.js';import b from'./UI_Normal.js';import c from'./UI_Markup.js';import d from'./UI_Markup_Base.js';import e from'./UI_Walkthrough.js';import f from'./UI_Fly.js';import g from'./UI_ObjectTransform.js';import h from'./UI_ScreenBox.js';let Control=function(i,j,k){let l=this,m={'NONE':-0x1,'ROTATE':0x0,'ZOOM':0x1,'PAN':0x2,'TOUCH_ROTATE':0x3,'TOUCH_ZOOM_PAN':0x4},n=m['NONE'],o=k['Enum']['CONTROL_STATE']['NORMAL'],p=k['Enum']['CONTROL_STATE']['NORMAL'];this['_sub']=k['Enum']['MOUSE_CONTROL_SUB_TYPE']['NONE'];let q=[],r,s,t,u,v=0x0,w=0x0,x=0x0;this['domElement']=i!==undefined?i:document,this['screen']={'left':0x0,'top':0x0,'width':0x0,'height':0x0},this['enabled']=![],this['EventCnt']=0x0,this['PivotUpdate']=!![];let y;z();function z(){k['namespace']('VIZCore.UIBase'),k['UIBase']=a,k['namespace']('VIZCore.UINormal'),k['UINormal']=b,k['namespace']('VIZCore.UIMarkup'),k['UIMarkup']=c,k['namespace']('VIZCore.UIMarkup_Base'),k['UIMarkup_Base']=d,k['namespace']('VIZCore.UIWalkthrough'),k['UIWalkthrough']=e,k['namespace']('VIZCore.UIFly'),k['UIFly']=f,k['namespace']('VIZCore.UIObjectTransform'),k['UIObjectTransform']=g,k['namespace']('VIZCore.UIScreenBox'),k['UIScreenBox']=h;{o=k['Enum']['CONTROL_STATE']['NORMAL'],k['UINormal']['prototype']=new k['UIBase'](undefined,k),k['UINormal']['prototype']['constructor']=k['UINormal'],q[k['Enum']['CONTROL_STATE']['NORMAL']]=new k['UINormal'](j,k),k['UIMarkup']['prototype']=new k['UIBase'](undefined,k),k['UIMarkup']['prototype']['constructor']=k['UIMarkup'],q[k['Enum']['CONTROL_STATE']['MARKUP']]=new k['UIMarkup'](j,k),k['UIWalkthrough']['prototype']=new k['UIBase'](undefined,k),k['UIWalkthrough']['prototype']['constructor']=k['UIWalkthrough'],q[k['Enum']['CONTROL_STATE']['WALKTHROUGH']]=new k['UIWalkthrough'](j,k),k['UIFly']['prototype']=new k['UIBase'](undefined,k),k['UIFly']['prototype']['constructor']=k['UIFly'],q[k['Enum']['CONTROL_STATE']['FLY']]=new k['UIFly'](j,k),k['UIObjectTransform']['prototype']=new k['UIBase'](undefined,k),k['UIObjectTransform']['prototype']['constructor']=k['UIObjectTransform'],q[k['Enum']['CONTROL_STATE']['OBJECTTRANSFORM']]=new k['UIObjectTransform'](j,k),k['UIScreenBox']['prototype']=new k['UIBase'](undefined,k),k['UIScreenBox']['prototype']['constructor']=k['UIScreenBox'],q[k['Enum']['CONTROL_STATE']['SCREENBOX']]=new k['UIScreenBox'](j,k);}B();}this['InitCanvas']=function(V){l['domElement']=V,l['enabled']=![],B();};function A(){if(!l['enabled'])return;l['enabled']=![],l['domElement']['removeEventListener']('contextmenu',function(V){V['preventDefault']();},![]),l['domElement']['removeEventListener']('mousedown',G,![]),l['domElement']['removeEventListener']('mousewheel',J,![]),l['domElement']['removeEventListener']('DOMMouseScroll',J,![]),l['domElement']['removeEventListener']('touchstart',M,![]),l['domElement']['removeEventListener']('touchend',O,![]),l['domElement']['removeEventListener']('touchmove',N,![]),l['domElement']['removeEventListener']('mousemove',H,![]),l['domElement']['removeEventListener']('mouseup',I,![]),l['domElement']['removeEventListener']('mouseover',F,![]),l['domElement']['removeEventListener']('mouseout',E,![]),window['removeEventListener']('keyup',R,![]),window['removeEventListener']('keypress',Q,![]);}function B(){if(l['enabled'])return;l['enabled']=!![],l['domElement']['addEventListener']('contextmenu',function(V){V['preventDefault']();},![]),l['domElement']['addEventListener']('mousedown',G,![]),l['domElement']['addEventListener']('mousewheel',J,![]),l['domElement']['addEventListener']('dblclick',K,![]),l['domElement']['addEventListener']('DOMMouseScroll',J,![]),l['domElement']['addEventListener']('touchstart',M,![]),l['domElement']['addEventListener']('touchend',O,![]),l['domElement']['addEventListener']('touchmove',N,![]),l['domElement']['addEventListener']('mousemove',H,![]),l['domElement']['addEventListener']('mouseup',I,![]),l['domElement']['addEventListener']('mouseover',F,![]),l['domElement']['addEventListener']('mouseout',E,![]),window['addEventListener']('keyup',R,![]),window['addEventListener']('keypress',Q,![]);}function C(V){if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return![];else return!![];}function D(V){let W=$('#'+j['Container']['id'])['offset']();if(W===undefined)return;let X=V['pageX']-W['left'],Y=V['pageY']-W['top'];if(V['target']==j['Canvas_Dual']){let Z=$('#'+j['Canvas_Dual']['id'])['offset']();X=X-Z['left'];}return{'x':X,'y':Y};}function E(V){if(l['enabled']===![])return;V['preventDefault'](),V['stopPropagation']();let W=$('#'+j['Container']['id'])['offset']();if(W===undefined)return;let X=V['pageX']-W['left'],Y=V['pageY']-W['top'];q[o]['mouseOut'](X,Y,V['button']);}function F(){q[o]['mouseOver']();}function G(V){if(l['enabled']===![])return;if(!C(V))return;j['EventHandler']['dispatchEvent'](k['Enum']['EVENT_TYPES']['Mouse']['Down'],V),V['preventDefault'](),V['stopPropagation']();let W=D(V),X=W['x'],Y=W['y'];{q[o]['KeyPress']['ctrlKey']=V['ctrlKey'],q[o]['KeyPress']['altKey']=V['altKey'],q[o]['KeyPress']['shiftKey']=V['shiftKey'];let Z=q[o]['mouseDown'](X,Y,V['button']);if(Z){}return;}}function H(V){if(l['enabled']===![])return;if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;V['preventDefault'](),V['stopPropagation'](),j['EventHandler']['dispatchEvent'](k['Enum']['EVENT_TYPES']['Mouse']['Move'],V);let W=D(V),X=W['x'],Y=W['y'];{q[o]['KeyPress']['ctrlKey']=V['ctrlKey'],q[o]['KeyPress']['altKey']=V['altKey'],q[o]['KeyPress']['shiftKey']=V['shiftKey'],q[o]['mouseMove'](X,Y);return;}};function I(V){if(l['enabled']===![])return;if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;V['preventDefault'](),V['stopPropagation'](),j['EventHandler']['dispatchEvent'](k['Enum']['EVENT_TYPES']['Mouse']['Up'],V);let W=D(V),X=W['x'],Y=W['y'];{q[o]['KeyPress']['ctrlKey']=V['ctrlKey'],q[o]['KeyPress']['altKey']=V['altKey'],q[o]['KeyPress']['shiftKey']=V['shiftKey'];let Z=q[o]['mouseUp'](X,Y,V['button']);if(Z){}return;}}function J(V){if(l['enabled']===![])return;V['stopPropagation']();if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;j['EventHandler']['dispatchEvent'](k['Enum']['EVENT_TYPES']['Mouse']['Wheel'],V);if(V['wheelDelta'])x=V['wheelDelta']/0x28;else V['detail']&&(x=-V['detail']/0x3);let W=$('#'+j['Container']['id'])['offset']();if(W===undefined)return;let X=V['pageX']-W['left'],Y=V['pageY']-W['top'];{q[o]['mouseWheel'](X,Y,x);return;}}function K(V){V['preventDefault'](),V['stopPropagation']();let W=$('#'+j['Container']['id'])['offset']();if(W===undefined)return;let X=V['pageX']-W['left'],Y=V['pageY']-W['top'];if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;j['EventHandler']['dispatchEvent'](k['Enum']['EVENT_TYPES']['Mouse']['DbClick'],V),q[o]['mouseDoubleClick'](X,Y,V['button']);}function L(){if(n===m['ROTATE']){if(u['x']===t['x']&&u['y']===t['y'])return;let V=u['x']-t['x'],W=u['y']-t['y'],X=new k['Matrix4']()['makeRotationX'](W/0x64),Y=new k['Matrix4']()['makeRotationY'](V/0x64),Z=new k['Matrix4']();{let a0=new k['Matrix4']()['copy'](j['Camera']['cameraMatrix']),a1=new k['Vector3']()['copy'](j['Camera']['pivot']);a1['applyMatrix4'](a0);let a2=new k['Matrix4'](),a3=new k['Vector3']()['copy'](a1)['multiplyScalar'](-0x1);a2['setPosition'](a3);let a4=new k['Matrix4']()['multiplyMatrices'](X,Y),a5=new k['Matrix4']()['setPosition'](a1),a6=new k['Matrix4']()['multiplyMatrices'](a4,a2);Z=new k['Matrix4']()['multiplyMatrices'](a5,a6);}j['Camera']['cameraMatrix']=new k['Matrix4']()['multiplyMatrices'](Z,j['Camera']['cameraMatrix']);}else{if(n===m['ZOOM']){let a7=j['Camera']['cameraZoomRatio'];if(j['Camera']['perspectiveView']){let a8=new k['Vector3']()['copy'](j['Camera']['pivot']);a8['applyMatrix4'](j['Camera']['cameraMatrix']);let a9=new k['Vector3']();a9['set'](0x0,0x0,j['Camera']['viewDistance']);let aa=new k['Vector3']()['subVectors'](a8,a9),ab=aa['length']();if(ab<0x0)ab=0x0;let ac=ab-j['Camera']['near']*1.5,ad=ac*a7;a7=ad/j['Camera']['viewDistance'];if(a7>0.5)a7=0.5;else{if(a7<0.001)a7=0.001;}}else a7*=0.5;x>0x0?j['Camera']['MulViewDistance'](0x1-a7):j['Camera']['MulViewDistance'](0x1/(0x1-a7));}else{if(n===m['PAN']){if(u['x']===t['x']&&u['y']===t['y'])return;let ae=u['x']-t['x'],af=u['y']-t['y'],ag=new k['Matrix4']()['multiplyMatrices'](j['Camera']['projectionMatrix'],j['Camera']['cameraMatrix']),ah=j['Camera']['world2ScreenWithMatrix'](ag,new k['Vector3']()['copy'](j['Camera']['pivot'])),ai=new k['Vector3'](t['x'],t['y'],ah['z']),aj=new k['Vector3'](u['x'],u['y'],ah['z']),ak=j['Camera']['screen2WorldWithMatrix'](j['Camera']['projectionMatrix'],new k['Vector3'](t['x'],t['y'],ah['z'])),al=j['Camera']['screen2WorldWithMatrix'](j['Camera']['projectionMatrix'],new k['Vector3'](u['x'],u['y'],ah['z'])),am=new k['Vector3']()['subVectors'](al,ak);if(ah['z']>0x1)am['multiplyScalar'](-0x1);let an=new k['Matrix4']();an['makeTranslation'](am['x'],am['y'],am['z']);let ao=new k['Matrix4']()['copy'](j['Camera']['cameraMatrix']);j['Camera']['cameraMatrix']['multiplyMatrices'](an,ao);}}}j['Camera']['ResizeGLWindow'](),j['Renderer']['MainFBClear'](),j['Renderer']['Render'](),t=u;}function M(V){if(l['enabled']===![])return;if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;{q[o]['touchStart'](V['touches']);return;}}function N(V){if(l['enabled']===![])return;if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;V['stopPropagation']();{q[o]['touchMove'](V['touches']);return;}}function O(V){if(l['enabled']===![])return;if(V['target']!==j['Canvas_Review']&&V['target']!==j['Canvas_Dual'])return;{q[o]['touchEnd'](V['touches']);return;}}function P(V){}function Q(V){if(l['enabled']===![])return;V['stopPropagation']();{let W=q[o]['keyPress'](V['keyCode']);return;}}function R(V){if(l['enabled']===![])return;V['preventDefault'](),V['stopPropagation']();{let W=q[o]['keyUp'](V['keyCode']);return;}}let S=(function(){let V=new k['Vector2']();return function(W,X){return V['set']((W-l['screen']['width']*0.5-l['screen']['left'])/(l['screen']['width']*0.5),(l['screen']['height']+0x2*(l['screen']['top']-X))/l['screen']['width']),V;};}());this['BackupMode']=function(){if(o===k['Enum']['CONTROL_STATE']['MARKUP'])return;p=o;},this['RestoreMode']=function(){l['SetMode'](p,undefined);};function T(V){if(V===undefined)return;if(o===V)return;l['BackupMode'](),q[o]['UIEnd'](),o=V,q[o]['UIBegin']();}function U(V){q[o]['SetUIMode'](V);}this['GetMode']=function(){return o;},this['GetUIMode']=function(){return q[o];},this['SetMode']=function(V,W){T(V),U(W);if(V!==k['Enum']['CONTROL_STATE']['MARKUP']||W!==k['Enum']['REVIEW_TYPES']['RK_SKETCH'])for(let X=j['Data']['Reviews']['length']-0x1;X>=0x0;X--){let Y=j['Data']['Reviews'][X];if(Y['itemType']===k['Enum']['REVIEW_TYPES']['RK_SKETCH'])j['Data']['Reviews']['splice'](X,0x1);}V!==k['Enum']['CONTROL_STATE']['MARKUP']&&j['MeshBlock']['Reset'](),j['Renderer']['Render']();},this['Lock']=function(){A();},this['Unlock']=function(){B();},this['Render']=function(){q[o]['Render']();},this['Render2D']=function(V){q[o]['Render2D'](V);},this['MouseDown']=function(V){G(V);},this['MouseMove']=function(V){H(V);},this['MouseUp']=function(V){I(V);},this['MouseWheel']=function(V){J(V);},this['MouseOver']=function(V){F(V);},this['MouseOut']=function(V){E(V);},this['DoubleClick']=function(V){K(V);},this['TouchStart']=function(V){M(V);},this['TouchEnd']=function(V){O(V);},this['TouchMove']=function(V){N(V);},this['SetSubType']=function(V){q[o]['SetSubType'](V);};};export default Control;